<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<style>
.comment
{
    padding-left: 20px;
    margin-top: 4px;
    margin-right: 4px;
    margin-bottom: 4px;
    border: 2px #000 solid;
}
.submission
{
    border: 4px #00f solid;
    padding-left: 20px;
}
.hidden
{
    display: none;
}
</style>
</head>
<body><div class="submission" id="t3_6l62bh">
    <p class="userinfo">
        <a href="https://www.reddit.com/u/_bdonkey">_bdonkey</a>
        <span class="score"> | 37 points</span>
        <span class="timestamp"> | Jul 04 2017 09:26:36</span>
    </p>
    <strong>[META] JavaScript bookmarklet to automatically link-ify MEGA IDs (and decryption keys if present)</strong>
    <p><p>Converts text like:</p>
<pre><code>/#F!p3x1nTqQ (stuff in between) !g2PCz8gDD0_RL9WhjT1NUw
</code></pre>
<p>to click-able links like:</p>
<p>https://mega.nz/#F!p3x1nTqQ!g2PCz8gDD0_RL9WhjT1NUw</p>
<p>Also works with bare Mega IDs only, without decryption keys. Saves you only a couple of seconds, but thought it might be worth sharing.</p>
<p>To install, highlight the entire line below and drag it to your bookmarks bar. (You can edit the bookmark to give it a name.)</p>
<pre><code>javascript:(function()%7Bvar%20regex%20%3D%20new%20RegExp('(%23F%3F!%5Ba-zA-Z0-9%5D%7B8%7D)(%3F%3D(%3F%3A.*(!%5Ba-zA-Z0-9_-%5D%7B22%2C%7D))%3F)'%2C%20'g')%3Bdocument.body.innerHTML%20%3D%20document.body.innerHTML.replace(regex%2C%20'%241%20(%3Ca%20href%3D%22https%3A%2F%2Fmega.nz%2F%241%242%22%20target%3D%22_blank%22%3Ehttps%3A%2F%2Fmega.nz%2F%241%242%3C%2Fa%3E)')%7D)()
</code></pre>
<p>To use, click that bookmark when you're on a page that has mega IDs and keys that you want to convert to links.</p>
<p>Note: it will screw up existing mega links on the page because my regex-fu is not strong, so only use it on pages where you want to convert an un-linkified MEGA id.</p>
<p>Source code:</p>
<pre><code>var regex = new RegExp('(#F?![a-zA-Z0-9]{8})(?=(?:.*(![a-zA-Z0-9_-]{22,}))?)', 'g');
document.body.innerHTML = document.body.innerHTML.replace(regex, '$1 (&lt;a href="https://mega.nz/$1$2" target="_blank"&gt;https://mega.nz/$1$2&lt;/a&gt;)');
</code></pre></p>
    <p class="toolbar">
        <a href="https://www.reddit.com/r/megalinks/comments/6l62bh">permalink</a>
    </p>
</div>
<div class="comment" id="t1_djs25zb">
    <p class="userinfo">
        <a
        class="toggle_hide_button"
        href="javascript:void(0)"
        onclick="toggle_collapse(this.parentElement.parentElement)">[-]
        </a>
        [deleted]
        <span class="score"> | 2 points</span>
        <span class="timestamp"> | Jul 04 2017 20:06:56</span>
    </p>
    <div class="collapsible">
        <p>[deleted]</p>
        <p class="toolbar">
            <a href="https://www.reddit.com/r/megalinks/comments/6l62bh/_/djs25zb">permalink</a>
        </p>
        <div class="comment" id="t1_djs6yz2">
    <p class="userinfo">
        <a
        class="toggle_hide_button"
        href="javascript:void(0)"
        onclick="toggle_collapse(this.parentElement.parentElement)">[-]
        </a>
        <a href="https://www.reddit.com/u/_bdonkey">_bdonkey</a>
        <span class="score"> | 1 points</span>
        <span class="timestamp"> | Jul 04 2017 21:49:47</span>
    </p>
    <div class="collapsible">
        <p>thanks for finding that! i updated the regex in the post, try it again?</p>
        <p class="toolbar">
            <a href="https://www.reddit.com/r/megalinks/comments/6l62bh/_/djs6yz2">permalink</a>
        </p>
        <div class="comment" id="t1_djsi8qf">
    <p class="userinfo">
        <a
        class="toggle_hide_button"
        href="javascript:void(0)"
        onclick="toggle_collapse(this.parentElement.parentElement)">[-]
        </a>
        [deleted]
        <span class="score"> | 2 points</span>
        <span class="timestamp"> | Jul 05 2017 02:19:42</span>
    </p>
    <div class="collapsible">
        <p>[deleted]</p>
        <p class="toolbar">
            <a href="https://www.reddit.com/r/megalinks/comments/6l62bh/_/djsi8qf">permalink</a>
        </p>
        <div class="comment" id="t1_djua0lq">
    <p class="userinfo">
        <a
        class="toggle_hide_button"
        href="javascript:void(0)"
        onclick="toggle_collapse(this.parentElement.parentElement)">[-]
        </a>
        <a href="https://www.reddit.com/u/_bdonkey">_bdonkey</a>
        <span class="score"> | 1 points</span>
        <span class="timestamp"> | Jul 06 2017 04:19:32</span>
    </p>
    <div class="collapsible">
        <p>thanks again, it should work now, but i'm sure you'll find other cases where it doesn't :)</p>
        <p class="toolbar">
            <a href="https://www.reddit.com/r/megalinks/comments/6l62bh/_/djua0lq">permalink</a>
        </p>
        
    </div>
</div>
    </div>
</div>
    </div>
</div>
    </div>
</div>

<div class="comment" id="t1_djtzaxs">
    <p class="userinfo">
        <a
        class="toggle_hide_button"
        href="javascript:void(0)"
        onclick="toggle_collapse(this.parentElement.parentElement)">[-]
        </a>
        <a href="https://www.reddit.com/u/kuretake">kuretake</a>
        <span class="score"> | 2 points</span>
        <span class="timestamp"> | Jul 06 2017 00:08:45</span>
    </p>
    <div class="collapsible">
        <p>How about something like this?</p>
<pre><code>$('.usertext-body').each(function() {
  $(this).html(function(_, html) {
    let link, key;
    return html
    .replace(/#F?!\w{8}/, function(a) { link = a; return a; })
    .replace(/![\w-]{22,}/, function(a) { key = a; return a; })
    .replace(/$/, function() {
      let txt;
      if (!link || !key) {
        return '';
      }
      const url = 'https://mega.nz/' + link + key;
      return '&lt;p&gt;&lt;b&gt;&lt;a href=' + url + ' target=_blank&gt;' + url + '&lt;/a&gt;&lt;/b&gt;&lt;/p&gt;';
    });
  });
});
</code></pre>
<p>Here's the bookmarklet:</p>
<pre><code>javascript:(function()%7B%24('.usertext-body').each(function()%20%7B%24(this).html(function(_%2C%20html)%20%7Blet%20link%2C%20key%3Breturn%20html.replace(%2F%23F%3F!%5Cw%7B8%7D%2F%2C%20function(a)%20%7B%20link%20%3D%20a%3B%20return%20a%3B%20%7D).replace(%2F!%5B%5Cw-%5D%7B22%2C%7D%2F%2C%20function(a)%20%7B%20key%20%3D%20a%3B%20return%20a%3B%20%7D).replace(%2F%24%2F%2C%20function()%20%7Blet%20txt%3Bif%20(!link%20%7C%7C%20!key)%20%7Breturn%20''%3B%7Dconst%20url%20%3D%20'https%3A%2F%2Fmega.nz%2F'%20%2B%20link%20%2B%20key%3Breturn%20'%3Cp%3E%3Cb%3E%3Ca%20href%3D'%20%2B%20url%20%2B%20'%20target%3D_blank%3E'%20%2B%20url%20%2B%20'%3C%2Fa%3E%3C%2Fb%3E%3C%2Fp%3E'%3B%7D)%3B%7D)%3B%7D)%7D)()
</code></pre>
<p>Bookmarklet generated with http://mrcoles.com/bookmarklet/</p>
        <p class="toolbar">
            <a href="https://www.reddit.com/r/megalinks/comments/6l62bh/_/djtzaxs">permalink</a>
        </p>
        <div class="comment" id="t1_djua7fr">
    <p class="userinfo">
        <a
        class="toggle_hide_button"
        href="javascript:void(0)"
        onclick="toggle_collapse(this.parentElement.parentElement)">[-]
        </a>
        <a href="https://www.reddit.com/u/_bdonkey">_bdonkey</a>
        <span class="score"> | 1 points</span>
        <span class="timestamp"> | Jul 06 2017 04:24:44</span>
    </p>
    <div class="collapsible">
        <p>this works great! does it only work on reddit and only on the first mega link+key it finds, though?</p>
<p>i was originally trying to make something that works on any website and on all the link+key combos, and for links without keys, too. would be cool to combine the two scripts somehow...</p>
        <p class="toolbar">
            <a href="https://www.reddit.com/r/megalinks/comments/6l62bh/_/djua7fr">permalink</a>
        </p>
        <div class="comment" id="t1_djulnpt">
    <p class="userinfo">
        <a
        class="toggle_hide_button"
        href="javascript:void(0)"
        onclick="toggle_collapse(this.parentElement.parentElement)">[-]
        </a>
        <a href="https://www.reddit.com/u/kuretake">kuretake</a>
        <span class="score"> | 1 points</span>
        <span class="timestamp"> | Jul 06 2017 11:49:05</span>
    </p>
    <div class="collapsible">
        <p>Yeah, mine is made to work only on reddit, and will run once for each "usertext-body" element. It assumes the link comes first, followed by the key. I'm sure this could be made more general, but since there's no actual standard for posting megalinks, that would be difficult.</p>
        <p class="toolbar">
            <a href="https://www.reddit.com/r/megalinks/comments/6l62bh/_/djulnpt">permalink</a>
        </p>
        
    </div>
</div>
    </div>
</div>
    </div>
</div>
</body>

<script>
function toggle_collapse(comment_div)
{
    var button = comment_div.getElementsByClassName("toggle_hide_button")[0];
    var collapsible = comment_div.getElementsByClassName("collapsible")[0];
    if (collapsible.classList.contains("hidden"))
    {
        collapsible.classList.remove("hidden");
        button.innerText = "[-]";
    }
    else
    {
        collapsible.classList.add("hidden");
        button.innerText = "[+]";
    }
}
</script>
</html>
